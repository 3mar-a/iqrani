{"ast":null,"code":"import React,{useState,useEffect}from'react';import{useParams,useNavigate,Link}from'react-router-dom';import{Container,Grid,Paper,Typography,Button,Rating,Box,Dialog,DialogTitle,DialogContent,DialogActions}from'@mui/material';import{loadStripe}from'@stripe/stripe-js';import api from'../../config/api';import{useAuth}from'../../context/AuthContext';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const stripePromise=loadStripe(process.env.REACT_APP_STRIPE_PUBLIC_KEY);const BookDetails=()=>{const{id}=useParams();const navigate=useNavigate();const{user}=useAuth();const[book,setBook]=useState(null);const[loading,setLoading]=useState(true);const[error,setError]=useState('');const[showConfirmDialog,setShowConfirmDialog]=useState(false);useEffect(()=>{const fetchBook=async()=>{try{const response=await api.get(\"/reader/books/\".concat(id));setBook(response.data);}catch(error){setError('حدث خطأ في جلب تفاصيل الكتاب');}finally{setLoading(false);}};fetchBook();},[id]);const handlePurchase=async()=>{if(!user){navigate('/login');return;}try{const stripe=await stripePromise;const response=await api.post('/payments/create-payment-intent',{bookId:id});const result=await stripe.redirectToCheckout({sessionId:response.data.sessionId});if(result.error){setError(result.error.message);}}catch(error){setError('حدث خطأ في عملية الشراء');}};if(loading)return/*#__PURE__*/_jsx(\"div\",{children:\"\\u062C\\u0627\\u0631\\u064A \\u0627\\u0644\\u062A\\u062D\\u0645\\u064A\\u0644...\"});if(error)return/*#__PURE__*/_jsx(\"div\",{children:error});if(!book)return/*#__PURE__*/_jsx(\"div\",{children:\"\\u0627\\u0644\\u0643\\u062A\\u0627\\u0628 \\u063A\\u064A\\u0631 \\u0645\\u0648\\u062C\\u0648\\u062F\"});return/*#__PURE__*/_jsxs(Container,{sx:{mt:4},children:[/*#__PURE__*/_jsxs(Grid,{container:true,spacing:4,children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:4,children:/*#__PURE__*/_jsx(Paper,{children:/*#__PURE__*/_jsx(\"img\",{src:book.coverImage,alt:book.title,style:{width:'100%',height:'auto'}})})}),/*#__PURE__*/_jsxs(Grid,{item:true,xs:12,md:8,children:[/*#__PURE__*/_jsx(Typography,{variant:\"h4\",component:\"h1\",gutterBottom:true,children:book.title}),/*#__PURE__*/_jsxs(Typography,{variant:\"subtitle1\",gutterBottom:true,children:[\"\\u0627\\u0644\\u0643\\u0627\\u062A\\u0628: \",book.author.username]}),/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',alignItems:'center',mb:2},children:[/*#__PURE__*/_jsx(Rating,{value:book.averageRating,readOnly:true,precision:0.5}),/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",sx:{ml:1},children:[\"(\",book.ratings.length,\" \\u062A\\u0642\\u064A\\u064A\\u0645)\"]})]}),/*#__PURE__*/_jsx(Typography,{variant:\"body1\",paragraph:true,children:book.description}),/*#__PURE__*/_jsxs(Typography,{variant:\"h5\",color:\"primary\",gutterBottom:true,children:[\"\\u0627\\u0644\\u0633\\u0639\\u0631: \",book.price,\" $\"]}),!book.hasPurchased?/*#__PURE__*/_jsx(Button,{variant:\"contained\",size:\"large\",onClick:()=>setShowConfirmDialog(true),children:\"\\u0634\\u0631\\u0627\\u0621 \\u0627\\u0644\\u0643\\u062A\\u0627\\u0628\"}):/*#__PURE__*/_jsx(Button,{variant:\"contained\",size:\"large\",component:Link,to:\"/read/\".concat(book._id),children:\"\\u0642\\u0631\\u0627\\u0621\\u0629 \\u0627\\u0644\\u0643\\u062A\\u0627\\u0628\"})]})]}),/*#__PURE__*/_jsxs(Dialog,{open:showConfirmDialog,onClose:()=>setShowConfirmDialog(false),children:[/*#__PURE__*/_jsx(DialogTitle,{children:\"\\u062A\\u0623\\u0643\\u064A\\u062F \\u0627\\u0644\\u0634\\u0631\\u0627\\u0621\"}),/*#__PURE__*/_jsx(DialogContent,{children:/*#__PURE__*/_jsx(Typography,{children:\"\\u0644\\u0627 \\u064A\\u0645\\u0643\\u0646 \\u062A\\u062D\\u0645\\u064A\\u0644 \\u0627\\u0644\\u0643\\u062A\\u0627\\u0628 \\u0628\\u0635\\u064A\\u063A\\u0629 PDF\\u060C \\u0641\\u0642\\u0637 \\u064A\\u0645\\u0643\\u0646\\u0643 \\u0642\\u0631\\u0627\\u0621\\u062A\\u0647 \\u0639\\u0628\\u0631 \\u0627\\u0644\\u0645\\u0648\\u0642\\u0639. \\u0647\\u0644 \\u062A\\u0631\\u064A\\u062F \\u0627\\u0644\\u0645\\u062A\\u0627\\u0628\\u0639\\u0629\\u061F\"})}),/*#__PURE__*/_jsxs(DialogActions,{children:[/*#__PURE__*/_jsx(Button,{onClick:()=>setShowConfirmDialog(false),children:\"\\u0625\\u0644\\u063A\\u0627\\u0621\"}),/*#__PURE__*/_jsx(Button,{onClick:handlePurchase,variant:\"contained\",children:\"\\u0645\\u062A\\u0627\\u0628\\u0639\\u0629 \\u0627\\u0644\\u0634\\u0631\\u0627\\u0621\"})]})]})]});};export default BookDetails;","map":{"version":3,"names":["React","useState","useEffect","useParams","useNavigate","Link","Container","Grid","Paper","Typography","Button","Rating","Box","Dialog","DialogTitle","DialogContent","DialogActions","loadStripe","api","useAuth","jsx","_jsx","jsxs","_jsxs","stripePromise","process","env","REACT_APP_STRIPE_PUBLIC_KEY","BookDetails","id","navigate","user","book","setBook","loading","setLoading","error","setError","showConfirmDialog","setShowConfirmDialog","fetchBook","response","get","concat","data","handlePurchase","stripe","post","bookId","result","redirectToCheckout","sessionId","message","children","sx","mt","container","spacing","item","xs","md","src","coverImage","alt","title","style","width","height","variant","component","gutterBottom","author","username","display","alignItems","mb","value","averageRating","readOnly","precision","ml","ratings","length","paragraph","description","color","price","hasPurchased","size","onClick","to","_id","open","onClose"],"sources":["C:/Users/Omar/Desktop/hgfjhgblknm/frontend/src/components/Books/BookDetails.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { useParams, useNavigate, Link } from 'react-router-dom';\r\nimport {\r\n  Container,\r\n  Grid,\r\n  Paper,\r\n  Typography,\r\n  Button,\r\n  Rating,\r\n  Box,\r\n  Dialog,\r\n  DialogTitle,\r\n  DialogContent,\r\n  DialogActions\r\n} from '@mui/material';\r\nimport { loadStripe } from '@stripe/stripe-js';\r\nimport api from '../../config/api';\r\nimport { useAuth } from '../../context/AuthContext';\r\n\r\nconst stripePromise = loadStripe(process.env.REACT_APP_STRIPE_PUBLIC_KEY);\r\n\r\nconst BookDetails = () => {\r\n  const { id } = useParams();\r\n  const navigate = useNavigate();\r\n  const { user } = useAuth();\r\n  const [book, setBook] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState('');\r\n  const [showConfirmDialog, setShowConfirmDialog] = useState(false);\r\n\r\n  useEffect(() => {\r\n    const fetchBook = async () => {\r\n      try {\r\n        const response = await api.get(`/reader/books/${id}`);\r\n        setBook(response.data);\r\n      } catch (error) {\r\n        setError('حدث خطأ في جلب تفاصيل الكتاب');\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchBook();\r\n  }, [id]);\r\n\r\n  const handlePurchase = async () => {\r\n    if (!user) {\r\n      navigate('/login');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const stripe = await stripePromise;\r\n      const response = await api.post('/payments/create-payment-intent', {\r\n        bookId: id\r\n      });\r\n\r\n      const result = await stripe.redirectToCheckout({\r\n        sessionId: response.data.sessionId\r\n      });\r\n\r\n      if (result.error) {\r\n        setError(result.error.message);\r\n      }\r\n    } catch (error) {\r\n      setError('حدث خطأ في عملية الشراء');\r\n    }\r\n  };\r\n\r\n  if (loading) return <div>جاري التحميل...</div>;\r\n  if (error) return <div>{error}</div>;\r\n  if (!book) return <div>الكتاب غير موجود</div>;\r\n\r\n  return (\r\n    <Container sx={{ mt: 4 }}>\r\n      <Grid container spacing={4}>\r\n        <Grid item xs={12} md={4}>\r\n          <Paper>\r\n            <img\r\n              src={book.coverImage}\r\n              alt={book.title}\r\n              style={{ width: '100%', height: 'auto' }}\r\n            />\r\n          </Paper>\r\n        </Grid>\r\n        <Grid item xs={12} md={8}>\r\n          <Typography variant=\"h4\" component=\"h1\" gutterBottom>\r\n            {book.title}\r\n          </Typography>\r\n          <Typography variant=\"subtitle1\" gutterBottom>\r\n            الكاتب: {book.author.username}\r\n          </Typography>\r\n          <Box sx={{ display: 'flex', alignItems: 'center', mb: 2 }}>\r\n            <Rating value={book.averageRating} readOnly precision={0.5} />\r\n            <Typography variant=\"body2\" sx={{ ml: 1 }}>\r\n              ({book.ratings.length} تقييم)\r\n            </Typography>\r\n          </Box>\r\n          <Typography variant=\"body1\" paragraph>\r\n            {book.description}\r\n          </Typography>\r\n          <Typography variant=\"h5\" color=\"primary\" gutterBottom>\r\n            السعر: {book.price} $\r\n          </Typography>\r\n          {!book.hasPurchased ? (\r\n            <Button\r\n              variant=\"contained\"\r\n              size=\"large\"\r\n              onClick={() => setShowConfirmDialog(true)}\r\n            >\r\n              شراء الكتاب\r\n            </Button>\r\n          ) : (\r\n            <Button\r\n              variant=\"contained\"\r\n              size=\"large\"\r\n              component={Link}\r\n              to={`/read/${book._id}`}\r\n            >\r\n              قراءة الكتاب\r\n            </Button>\r\n          )}\r\n        </Grid>\r\n      </Grid>\r\n\r\n      <Dialog open={showConfirmDialog} onClose={() => setShowConfirmDialog(false)}>\r\n        <DialogTitle>تأكيد الشراء</DialogTitle>\r\n        <DialogContent>\r\n          <Typography>\r\n            لا يمكن تحميل الكتاب بصيغة PDF، فقط يمكنك قراءته عبر الموقع.\r\n            هل تريد المتابعة؟\r\n          </Typography>\r\n        </DialogContent>\r\n        <DialogActions>\r\n          <Button onClick={() => setShowConfirmDialog(false)}>إلغاء</Button>\r\n          <Button onClick={handlePurchase} variant=\"contained\">\r\n            متابعة الشراء\r\n          </Button>\r\n        </DialogActions>\r\n      </Dialog>\r\n    </Container>\r\n  );\r\n};\r\n\r\nexport default BookDetails; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}