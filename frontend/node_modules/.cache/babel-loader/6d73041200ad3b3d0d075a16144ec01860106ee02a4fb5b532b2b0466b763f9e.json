{"ast":null,"code":"import React,{useState,useEffect}from'react';import{useParams,Navigate}from'react-router-dom';import{Container,Paper,Typography,Box}from'@mui/material';import{Document,Page,pdfjs}from'react-pdf';import api from'../../config/api';import{useAuth}from'../../context/AuthContext';// تعيين worker لمكتبة PDF.js\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";pdfjs.GlobalWorkerOptions.workerSrc=\"//cdnjs.cloudflare.com/ajax/libs/pdf.js/\".concat(pdfjs.version,\"/pdf.worker.min.js\");const ReadBook=()=>{const{id}=useParams();const{user}=useAuth();const[pdfUrl,setPdfUrl]=useState(null);const[numPages,setNumPages]=useState(null);const[pageNumber,setPageNumber]=useState(1);const[loading,setLoading]=useState(true);const[error,setError]=useState('');useEffect(()=>{const fetchBook=async()=>{try{const response=await api.get(\"/reader/read/\".concat(id));setPdfUrl(response.data.readUrl);}catch(error){var _error$response,_error$response$data;setError(((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.message)||'حدث خطأ في تحميل الكتاب');}finally{setLoading(false);}};fetchBook();},[id]);const onDocumentLoadSuccess=_ref=>{let{numPages}=_ref;setNumPages(numPages);};if(loading)return/*#__PURE__*/_jsx(\"div\",{children:\"\\u062C\\u0627\\u0631\\u064A \\u0627\\u0644\\u062A\\u062D\\u0645\\u064A\\u0644...\"});if(error)return/*#__PURE__*/_jsx(\"div\",{children:error});if(!user)return/*#__PURE__*/_jsx(Navigate,{to:\"/login\"});return/*#__PURE__*/_jsx(Container,{sx:{mt:4},children:/*#__PURE__*/_jsxs(Paper,{sx:{p:3},children:[/*#__PURE__*/_jsx(Box,{sx:{display:'flex',justifyContent:'center',mb:2},children:/*#__PURE__*/_jsxs(Typography,{children:[\"\\u0635\\u0641\\u062D\\u0629 \",pageNumber,\" \\u0645\\u0646 \",numPages]})}),/*#__PURE__*/_jsx(Box,{sx:{display:'flex',justifyContent:'center'},children:/*#__PURE__*/_jsx(Document,{file:pdfUrl,onLoadSuccess:onDocumentLoadSuccess,loading:/*#__PURE__*/_jsx(\"div\",{children:\"\\u062C\\u0627\\u0631\\u064A \\u062A\\u062D\\u0645\\u064A\\u0644 \\u0627\\u0644\\u0643\\u062A\\u0627\\u0628...\"}),children:/*#__PURE__*/_jsx(Page,{pageNumber:pageNumber,renderTextLayer:false,renderAnnotationLayer:false})})}),/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',justifyContent:'center',mt:2,gap:2},children:[/*#__PURE__*/_jsx(\"button\",{disabled:pageNumber<=1,onClick:()=>setPageNumber(pageNumber-1),children:\"\\u0627\\u0644\\u0633\\u0627\\u0628\\u0642\"}),/*#__PURE__*/_jsx(\"button\",{disabled:pageNumber>=numPages,onClick:()=>setPageNumber(pageNumber+1),children:\"\\u0627\\u0644\\u062A\\u0627\\u0644\\u064A\"})]})]})});};export default ReadBook;","map":{"version":3,"names":["React","useState","useEffect","useParams","Navigate","Container","Paper","Typography","Box","Document","Page","pdfjs","api","useAuth","jsx","_jsx","jsxs","_jsxs","GlobalWorkerOptions","workerSrc","concat","version","ReadBook","id","user","pdfUrl","setPdfUrl","numPages","setNumPages","pageNumber","setPageNumber","loading","setLoading","error","setError","fetchBook","response","get","data","readUrl","_error$response","_error$response$data","message","onDocumentLoadSuccess","_ref","children","to","sx","mt","p","display","justifyContent","mb","file","onLoadSuccess","renderTextLayer","renderAnnotationLayer","gap","disabled","onClick"],"sources":["C:/Users/Omar/Desktop/hgfjhgblknm/frontend/src/components/Books/ReadBook.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { useParams, Navigate } from 'react-router-dom';\r\nimport { Container, Paper, Typography, Box } from '@mui/material';\r\nimport { Document, Page, pdfjs } from 'react-pdf';\r\nimport api from '../../config/api';\r\nimport { useAuth } from '../../context/AuthContext';\r\n\r\n// تعيين worker لمكتبة PDF.js\r\npdfjs.GlobalWorkerOptions.workerSrc = `//cdnjs.cloudflare.com/ajax/libs/pdf.js/${pdfjs.version}/pdf.worker.min.js`;\r\n\r\nconst ReadBook = () => {\r\n  const { id } = useParams();\r\n  const { user } = useAuth();\r\n  const [pdfUrl, setPdfUrl] = useState(null);\r\n  const [numPages, setNumPages] = useState(null);\r\n  const [pageNumber, setPageNumber] = useState(1);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState('');\r\n\r\n  useEffect(() => {\r\n    const fetchBook = async () => {\r\n      try {\r\n        const response = await api.get(`/reader/read/${id}`);\r\n        setPdfUrl(response.data.readUrl);\r\n      } catch (error) {\r\n        setError(error.response?.data?.message || 'حدث خطأ في تحميل الكتاب');\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchBook();\r\n  }, [id]);\r\n\r\n  const onDocumentLoadSuccess = ({ numPages }) => {\r\n    setNumPages(numPages);\r\n  };\r\n\r\n  if (loading) return <div>جاري التحميل...</div>;\r\n  if (error) return <div>{error}</div>;\r\n  if (!user) return <Navigate to=\"/login\" />;\r\n\r\n  return (\r\n    <Container sx={{ mt: 4 }}>\r\n      <Paper sx={{ p: 3 }}>\r\n        <Box sx={{ display: 'flex', justifyContent: 'center', mb: 2 }}>\r\n          <Typography>\r\n            صفحة {pageNumber} من {numPages}\r\n          </Typography>\r\n        </Box>\r\n        <Box sx={{ display: 'flex', justifyContent: 'center' }}>\r\n          <Document\r\n            file={pdfUrl}\r\n            onLoadSuccess={onDocumentLoadSuccess}\r\n            loading={<div>جاري تحميل الكتاب...</div>}\r\n          >\r\n            <Page\r\n              pageNumber={pageNumber}\r\n              renderTextLayer={false}\r\n              renderAnnotationLayer={false}\r\n            />\r\n          </Document>\r\n        </Box>\r\n        <Box sx={{ display: 'flex', justifyContent: 'center', mt: 2, gap: 2 }}>\r\n          <button\r\n            disabled={pageNumber <= 1}\r\n            onClick={() => setPageNumber(pageNumber - 1)}\r\n          >\r\n            السابق\r\n          </button>\r\n          <button\r\n            disabled={pageNumber >= numPages}\r\n            onClick={() => setPageNumber(pageNumber + 1)}\r\n          >\r\n            التالي\r\n          </button>\r\n        </Box>\r\n      </Paper>\r\n    </Container>\r\n  );\r\n};\r\n\r\nexport default ReadBook; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}